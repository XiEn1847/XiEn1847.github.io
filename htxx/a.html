<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>gif js</title>
  <meta name="renderer" content="webkit">
  <!--<meta crossorigin="anonymous">-->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <script src="/gifjs/gif.js"></script>
</head>
<body>
<button type="button" class="btn">生成 GIF</button>
<img class="result-gif" width="667" height="375" src="" alt="">
<script type="text/javascript">

let imgSore = {num: 0};
let imgNum = 0;
const srcRoot = "images/";
const w = 667;
const h = 375;
const delay = 120;

function initImg(len) {
  return new Promise(resolve => {
    let image = new Image();

    image.setAttribute('crossOrigin', '');
    image.onload = image.onerror = () => {
      resolve(image);
    };
    image.src = "/images/pray/" + len + ".png";
    // cdn later

  })
}

function createImg(len) {
  let STORE = [];
  for (let i = 1; i <= len; i++) {
    STORE.push(initImg(i));
  }
  return STORE;
}

function createGif() {
  let IMG_ARR = createImg(8);
  let gif = new GIF({
                      width: w,
                      height: h,
                      workers: 2,
                      quality: 10,
                      workerScript: '/gifjs/gif.worker.js'
                    });
  // 画布元素
  let canvas = document.createElement('canvas');
  const msg = [
        "好啊",
        "就算你是一流工程师",
        "就算你出报告再完美",
        "我叫你改报告你就要改",
        "毕竟我是客户",
        "客户了不起啊",
        "Sorry 客户真的了不起",
        "",
      ]
  ;
  canvas.width = w;
  canvas.height = h;
  let context = canvas.getContext('2d');
  Promise.all(IMG_ARR).then(value => {
    // console.log(value);
    value.forEach((value1, index) => {
      // // 绘制图片 imgSore
      context.clearRect(0, 0, w, h);
      context.drawImage(value1, 0, 0);
// // // 绘制文字
      context.fillStyle = "#fff";
//     console.log(context);
      if (msg[index]) {
        context.fillText(msg[index], w / 2, h - 20);
      }
// // 作为帧插入GIF
      gif.addFrame(context, {
        delay: delay,
        copy: true
      });
    });
    gif.on('finished', function (blob) {
      // 这里的blob就是gif图片blod格式信息
      console.log(blob);
      // window.open(URL.createObjectURL(blob));
      document.querySelector(".result-gif").src = URL.createObjectURL(blob);
    });
    gif.render();
  });
}

document.querySelector(".btn").addEventListener("click", () => {
  // alert("msg");
  createGif();
});


</script>
</body>
</html>